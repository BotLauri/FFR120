function updatedTheta = UpdateOrientationWithDelay(theta, isNeighbour, eta, deltaT, h, oldThetas)
    if (h > size(oldThetas, 2))
        updatedTheta = theta;
        return
    end
    N = size(theta, 1);
    r = rand - 0.5;
    updatedTheta = zeros(N, 1);
    for i = 1:N
        neighbours = find(isNeighbour(i,:));
        averageTheta = atan2(mean(sin(oldThetas{i - h}(neighbours))), mean(cos(theta(neighbours))));
        updatedTheta(i) = averageTheta + eta*r*deltaT;
    end
end